# WebSocket服务器部署工具

这是一个简化的WebSocket服务器部署工具，用于在共享主机环境中快速部署WebSocket服务和哪吒探针。

## 特点

- 自动检测域名目录
- 引导用户创建Node.js应用
- 自动安装和配置WebSocket服务
- 自动安装和配置哪吒探针
- 支持重启探针服务
- 支持修改配置文件
- 详细的日志记录

## 使用方法

### 快速开始

1. 下载脚本：

```bash
curl -L https://raw.githubusercontent.com/mqiancheng/host-node-ws/main/setup.sh -o setup.sh && chmod +x setup.sh
```

2. 运行脚本：

```bash
./setup.sh
```

### 详细步骤

1. **创建Node.js应用**：
   - 脚本会首先询问您是否已经在控制面板中创建了Node.js应用
   - 如果没有，脚本会引导您完成创建过程
   - 按照提示在控制面板中创建Node.js应用，然后重新运行脚本

2. **选择域名**：
   - 脚本会自动扫描您的域名目录
   - 从列表中选择一个域名，或手动输入

3. **检查组件**：
   - 脚本会检查必要的组件是否已安装（index.js、package.json、哪吒探针配置）
   - 如果缺少任何组件，脚本会提示您安装

4. **安装缺失组件**：
   - 如果缺少WebSocket服务组件，脚本会自动下载和配置
   - 如果缺少哪吒探针，脚本会引导您安装

5. **管理服务**：
   - 脚本提供了简单的菜单来管理服务：
     - 修改配置文件
     - 重启探针
     - 强制重新安装

## 配置选项

安装过程中，您需要提供以下信息：

- **域名**：脚本会自动扫描您的域名目录，您可以从列表中选择或手动输入
- **UUID**：可以自动生成或手动输入
- **哪吒服务器地址**：哪吒探针服务器地址（格式：nz.example.com:5555）
- **哪吒客户端密钥**：哪吒探针的客户端密钥

## 日志记录

脚本会在用户主目录下创建详细的日志文件（格式：`~/tmp/ws_setup_logs/ws_setup_日期时间.log`），记录安装过程中的每一步操作。如果遇到问题，请查看此日志文件以获取详细信息。

## 常见问题

1. **WebSocket服务无法启动**：检查node.log文件查看错误信息
2. **哪吒探针未连接**：确认服务器地址和密钥是否正确，确保TLS设置正确
3. **域名目录检测失败**：确认您的域名是否已在控制面板中创建，并且目录结构正确
4. **进程检测问题**：脚本会自动检测lsnode进程和普通node进程，如果检测失败，可以尝试重启服务

## 注意事项

- 脚本默认使用TLS连接哪吒服务器
- 日志文件存储在`~/tmp/ws_setup_logs/`目录下
- 哪吒探针配置保存在`~/tmp/nezha_config.conf`文件中
- 强制重新安装会删除所有相关文件和进程

## 贡献

欢迎提交问题和改进建议到GitHub仓库：[https://github.com/mqiancheng/host-node-ws](https://github.com/mqiancheng/host-node-ws)

## 许可证

MIT
